<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Stories Hub</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{--card-max-width:360px}
    body{font-family: Archivo, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:#06070a; color:#e6eef8}
    .story-card{max-width:var(--card-max-width)}
    .card-img-top{height:180px;object-fit:cover}
    .codebox{background:#0b0f14;color:#c9d1d9;padding:1rem;border-radius:.5rem;font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;overflow:auto}
    .muted-small{font-size:.9rem;color:#9aa6b2}
    footer{padding:2rem 0;color:#9aa6b2}
    .navbar-brand img{height:36px; width:auto}
    .card .card-body p{color:rgba(230,238,248,0.9)}
    /* make placeholder images less jarring */
    .placeholder-dark{background:#1b1f24;color:#9aa6b2;display:flex;align-items:center;justify-content:center;height:180px}
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="assets/logo.png" alt="DreamForgeGames Logo" onerror="this.style.display='none'">
      <span class="ms-2">DreamForge Games | Stories Hub</span>
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain" aria-controls="navMain" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navMain">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="contribute.html">Publish your Story</a></li>
        <li class="nav-item"><a class="nav-link" href="install.html">How to install</a></li>
        <li class="nav-item"><a class="nav-link" id="refreshLink" href="#">Refresh</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container my-4">
  <header class="d-flex align-items-center justify-content-between mb-4">
    <div>
      <h1 class="h3">Stories Hub</h1>
      <p class="muted-small mb-0">A hub where people can share their stories.</p>
    </div>
    <div>
        <div id="openExamples"></div>
    </div>
  </header>

  <section id="alertPlace"></section>

  <section id="grid" class="row g-3">
    <!-- Cards will be injected by JS -->
  </section>


  <hr class="my-5" style="border-color: rgba(255,255,255,0.06)">
  <footer class="mt-5">
    <div class="d-flex justify-content-between align-items-center">
      <div class="muted-small">Made with ❤️ (and ChatGPT) — DreamForge Games</div>
    </div>
  </footer>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
// --- CONFIG ---
const STORIES_JSON = 'stories.json'; // must be in the same folder as this HTML

// helper: show alert
function showAlert(type, msg, timeout=5000){
  const place = document.getElementById('alertPlace');
  const id = 'a'+Math.random().toString(36).slice(2,9);
  place.innerHTML = `<div id="${id}" class="alert alert-${type} alert-dismissible fade show" role="alert">${msg}<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button></div>` + place.innerHTML;
  if(timeout) setTimeout(()=>{ const el=document.getElementById(id); if(el) el.remove(); }, timeout);
}

async function loadStories(){
  try{
    const res = await fetch(STORIES_JSON, {cache: 'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const data = await res.json();
    if(!data.stories || !Array.isArray(data.stories)) throw new Error('Invalid JSON format: expected an array under "stories"');
    renderCards(data.stories);
  }catch(err){
    console.error(err);
    showAlert('danger', `Failed to load <code>${STORIES_JSON}</code>: ${err.message}`, 0);
    document.getElementById('grid').innerHTML = `<div class="col-12"><div class="p-4 bg-dark border rounded text-light">Error loading stories. Open the console for details.</div></div>`;
  }
}

function renderCards(stories){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  if(stories.length === 0){
    grid.innerHTML = `<div class="col-12"><div class="alert alert-info">No stories found. You can add some — see the Contribute guide.</div></div>`;
    return;
  }

  stories.forEach(st => {
    const col = document.createElement('div');
    col.className = 'col-12 col-sm-6 col-md-4 col-lg-3 d-flex';

    const card = document.createElement('div');
    card.className = 'card story-card flex-fill shadow-sm bg-dark text-light border-secondary';

    const img = document.createElement('img');
    img.className = 'card-img-top';
    img.loading = 'lazy';
    img.alt = st.name + ' Cover';
    img.src = st.imageUrl || '';
    img.onerror = ()=>{ 
      // replace missing image with a dark placeholder
      const ph = document.createElement('div');
      ph.className = 'placeholder-dark';
      ph.textContent = 'No image';
      if(img.parentNode) img.parentNode.replaceChild(ph, img);
    }

    const cardBody = document.createElement('div');
    cardBody.className = 'card-body d-flex flex-column';

    const title = document.createElement('h5');
    title.className = 'card-title mb-1';
    title.textContent = st.name || 'Untitled Story';

    const desc = document.createElement('p');
    desc.className = 'card-text mb-2';
    desc.textContent = st.description || '';

    const meta = document.createElement('div');
    meta.className = 'mt-auto d-flex justify-content-between align-items-center';

    const dlBtn = document.createElement('a');
    dlBtn.className = 'btn btn-sm btn-outline-light';
    dlBtn.href = st.downloadFile || '#';
    dlBtn.setAttribute('target','_blank');
    dlBtn.rel = 'noopener';
    dlBtn.textContent = 'Download';
    if(!st.downloadFile) dlBtn.classList.add('disabled');

    const small = document.createElement('small');
    small.className = 'text-muted';
    small.textContent = st.fileSize ? st.fileSize : '';

    meta.appendChild(dlBtn);
    meta.appendChild(small);

    cardBody.appendChild(title);
    cardBody.appendChild(desc);
    cardBody.appendChild(meta);

    card.appendChild(img);
    card.appendChild(cardBody);

    col.appendChild(card);
    grid.appendChild(col);
  });
}

// UI
document.getElementById('refreshLink').addEventListener('click', (e)=>{ e.preventDefault(); loadStories(); });
document.getElementById('openExamples').addEventListener('click', (e)=>{ e.preventDefault(); window.location.href = 'contribute.html'; });

// Start
loadStories();

// Debug: Expose some functions
window._storiesHub = { loadStories, renderCards };
</script>
</body>
</html>